{"ledger_id":"led_01KGAHB6N028ADRCCMH2K526PV","ts":"2026-01-31T17:24:23.328598Z","author":"ingest-agent","reason":"Create a concise source summary of the JJ Gateway v0.1 plan/spec for future reference by implementation agents.","op":"upsert_knowledge","doc_path":"summaries/sources/jj-gateway-v-0.md","doc_id":"mem_01KGAHB6MZ6CGJNQKQSTC1JQTY","new_hash":"4553feea99f27fb1cbc3421eea3054ba2eccdb735fee753a295edfa6b665a8e2","patch":{"doc_path":"summaries/sources/jj-gateway-v-0.md","title":"JJ Gateway v0.1 — Formal Plan / Spec (CLI + Telegram)","type":"source_summary","status":"active","tags_add":["jj","gateway","spec","cli","telegram","event-sourcing","websocket"],"confidence":0.9,"body_append":"## Summary\n\nJJ Gateway v0.1 specifies a first shippable “Gateway + Agent Loop” system with two message channels—local CLI (`jj chat`) and Telegram bot—both routed through a single local daemon (`jj gateway`). The Gateway is the control plane: it manages sessions, persists transcripts, coordinates a per-session serialized agent run loop (LLM streaming), and routes outbound responses back to the originating channel.\n\nCore design principles: session key is the unit of consistency; all state is derived from an append-only event log (JSONL transcript per session); the daemon is crash-only and restart-safe via replay/rehydration from `sessions.json` + transcripts; idempotency is required to make retries safe and prevent duplicate side effects (notably for Telegram update delivery and client reconnect retries).\n\nArchitecture components: Gateway Core (session manager, run coordinator, model provider interface, internal event bus/router), CLI Adapter (WebSocket client with streaming display and reconnect/resubscribe), and Telegram Adapter (long polling via `getUpdates`, mapping `tg:<chat_id>` to session keys, dedupe via durable offset/update tracking, and outbound `sendMessage`). Concurrency model: one active run per session key; cross-session concurrency allowed with a configurable global cap.\n\nPersistence layout defaults to `~/.jj/gateway/` with `sessions.json` as a small index (metadata + channel bindings) and `transcripts/<session_id>.jsonl` as source-of-truth logs (header + typed entries: `message`, `assistant_delta` optional, `assistant_final`, `error`). Idempotency can be implemented with a dedicated `dedupe/` store or via scanning recent transcript lines.\n\nGateway API for CLI: JSON frames over loopback WebSocket (`gateway.hello`, `session.open`, `session.send`, `session.subscribe`, `session.history`, dev-only `gateway.shutdown`), and events (`run.started`, `assistant.delta`, `assistant.final`, `run.completed`, `error`). Config lives at `~/.jj/gateway/config.toml` with sections for gateway, model provider, and Telegram; secrets must be env-var only. Deliverables include Rust workspace layout, tests (persistence, idempotency, WS happy path, Telegram dedupe with mocks), and docs (quickstart/protocol/storage).","sources_add":[{"thread_id":"","event_ids":["src_01KGAH9QWXDTVYBKPNG42FDGDE"]}]}}
{"ledger_id":"led_01KGAHB6N1VNP9KP1SAR1S2ZAE","ts":"2026-01-31T17:24:23.329426Z","author":"ingest-agent","reason":"Record the JJ Gateway v0.1 effort as a concrete project with deliverables, components, milestones, and acceptance criteria.","op":"upsert_knowledge","doc_path":"knowledge/projects/jj-gateway.md","doc_id":"mem_01KGAHB6N1NY1HKH25H9JYNZSM","new_hash":"92cd9c3ef34c8b0c7b0e9c6b3d3d91bc4efed04675b34ba297901f8ca1170e46","patch":{"doc_path":"knowledge/projects/jj-gateway.md","title":"JJ Gateway (v0.1)","type":"project","status":"active","tags_add":["jj","gateway","daemon","cli","telegram","rust","websocket","event-sourcing"],"confidence":0.9,"body_append":"## Overview\n\nJJ Gateway v0.1 is a local “control plane” daemon (`jj gateway`) plus channel adapters that together provide durable, replayable chat sessions and an agent execution loop. Channels in v0.1: local CLI REPL (`jj chat`) and Telegram bot (long polling). All inbound/outbound messages flow through the Gateway.\n\n## Goals (v0.1)\n\n- One long-running daemon that owns:\n  - session storage/index and transcripts\n  - message intake from CLI + Telegram\n  - per-session serialized agent loop with LLM streaming\n  - outbound routing back to channels\n- Durable sessions: append-only per-session transcripts (`.jsonl`) + `sessions.json` index.\n- Restart-safe/crash-only operation; idempotency for side-effecting operations.\n\n## Non-goals (deferred)\n\n- Multi-node device capabilities (camera/screen/etc)\n- Tool/plugin marketplace, deep tool system\n- Subagents/lanes beyond minimal per-session serialization\n- Cron scheduler\n- Full web UI\n\n## Key design principles\n\n- Session key is unit of consistency; only one active run per session key.\n- Event log is source of truth; state derived from transcripts.\n- Crash-only + replayable via rehydration from `sessions.json` + transcript JSONL.\n- Idempotency for protocol methods and inbound message dedupe.\n\n## Components\n\n- **Gateway Core**: session manager, run coordinator, model provider interface, internal event bus, channel router.\n- **CLI Adapter**: `jj chat` WebSocket client with streaming output, reconnect/resubscribe.\n- **Telegram Adapter**: long polling `getUpdates`, map `tg:<chat_id>` to sessions, dedupe, outbound `sendMessage`.\n\n## Storage\n\nDefault root: `~/.jj/gateway/`\n- `sessions.json` (small index/metadata)\n- `transcripts/<session_id>.jsonl` (append-only header + typed entries)\n- optional: `dedupe/`, `logs/` (stream capture)\n\n## Protocol/API (loopback WebSocket)\n\nClient frames:\n- req: `{type:req,id,method,params,idempotency_key}`\n- res: `{type:res,id,ok,payload}`\n- event: `{type:event,event,payload,seq}`\n\nMethods (v0.1): `gateway.hello`, `session.open`, `session.send`, `session.subscribe`, `session.history`, dev-only `gateway.shutdown`.\n\nEvents: `run.started`, `assistant.delta`, `assistant.final`, `run.completed`, `error`.\n\n## Configuration\n\nConfig file: `~/.jj/gateway/config.toml` (or `--config`). Sections:\n- `[gateway]` port, data_dir, log_level, max_concurrency\n- `[model]` provider, model, api_key_env\n- `[telegram]` enabled, bot_token_env, allow_chat_ids\n\nSecrets via env vars only; never written to transcripts/logs.\n\n## Milestones\n\n- M0 scaffold: daemon starts, WS handshake, CLI connects\n- M1 sessions + persistence\n- M2 agent loop streaming (CLI)\n- M3 Telegram adapter + restart-safe dedupe\n- M4 hardening (idempotency store, backoff/retry, shutdown)\n\n## Definition of Done highlights\n\n- Rust workspace: `crates/jj-gateway`, `crates/jj-cli`, `crates/jj-proto`, plus docs/examples.\n- `cargo build --workspace` + `cargo test --workspace` pass.\n- Restart-safe sessions/history; idempotent `session.send` does not duplicate transcript entries.\n- Telegram allowlist default-deny; restart does not replay old updates.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAH9QWXDTVYBKPNG42FDGDE"]}]}}
{"ledger_id":"led_01KGAHB6N2EZSK07NEJCVAGZVR","ts":"2026-01-31T17:24:23.330121Z","author":"ingest-agent","reason":"Capture system-level facts about JJ Gateway v0.1 architecture, storage, protocol, and operational invariants that other agents can rely on.","op":"upsert_knowledge","doc_path":"knowledge/system/jj-gateway-architecture.md","doc_id":"mem_01KGAHB6N1JNPM0C723JVFMMXQ","new_hash":"fc37ba140aa419e2affc24b408a0840b27ed21eb119ae1ca0849900ce3b0abb8","patch":{"doc_path":"knowledge/system/jj-gateway-architecture.md","title":"JJ Gateway v0.1 system architecture & invariants","type":"system","status":"active","tags_add":["jj","gateway","architecture","event-sourcing","idempotency","sessions","websocket","telegram"],"confidence":0.9,"body_append":"## Core invariants\n\n- **Gateway is the control plane**: all channel messages (CLI, Telegram) are normalized into internal events and flow through the daemon.\n- **Session key is the unit of consistency**: one serialized agent run per `session_key`.\n- **Event log is source of truth**: state is derived from append-only per-session transcript JSONL.\n- **Crash-only + replayable**: restart rehydrates from `sessions.json` + transcript logs.\n- **Idempotency everywhere**: retries must be safe across restarts/network failures.\n\n## Concurrency model (v0.1)\n\n- Per-session lock ensures only one active run per `session_key`.\n- Cross-session concurrency allowed; capped by configurable global semaphore (`max_concurrency`).\n\n## Channels / adapters\n\n- **CLI**: `jj chat` WebSocket client connects to loopback server, subscribes to session events, displays streaming deltas.\n- **Telegram**: long polling `getUpdates`, maps chats to `session_key = tg:<chat_id>`, ignores non-text messages in v0.1, sends final responses with `sendMessage`.\n\n## Storage layout\n\nDefault root: `~/.jj/gateway/`\n- `sessions.json` (index: `session_key -> {session_id, metadata, channel bindings, model flags}`)\n- `transcripts/<session_id>.jsonl` (append-only)\n- optional: `dedupe/` (idempotency records), `logs/` (raw stream capture)\n\n### Transcript entry types (v0.1 minimal)\n\n- `header` (first line)\n- `message` (user)\n- `assistant_delta` (optional/debug)\n- `assistant_final`\n- `error`\n\n## Gateway WebSocket protocol\n\n- Request frame: `{ \"type\":\"req\", \"id\":\"uuid\", \"method\":\"...\", \"params\":{...}, \"idempotency_key\":\"...\" }`\n- Response frame: `{ \"type\":\"res\", \"id\":\"uuid\", \"ok\":true, \"payload\":{...} }`\n- Event frame: `{ \"type\":\"event\", \"event\":\"assistant.delta\", \"payload\":{...}, \"seq\":123 }`\n\nRequired methods: `gateway.hello`, `session.open`, `session.send`, `session.subscribe`, `session.history`, dev-only `gateway.shutdown`.\n\nEvents: `assistant.delta`, `assistant.final`, `run.started`, `run.completed`, `error`.\n\n## Configuration\n\n`~/.jj/gateway/config.toml` sections:\n- `[gateway]` port, data_dir, log_level, max_concurrency\n- `[model]` provider, model, api_key_env\n- `[telegram]` enabled, bot_token_env, allow_chat_ids\n\nSecrets are loaded from environment variables and must not be persisted in transcripts/logs.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAH9QWXDTVYBKPNG42FDGDE"]}]}}
{"ledger_id":"led_01KGAHB6N2V9Z8NHWTAGBXSS7J","ts":"2026-01-31T17:24:23.330820Z","author":"ingest-agent","reason":"Extract explicit preference-like requirements around security, secrets handling, and minimal v0.1 scope from the spec.","op":"upsert_knowledge","doc_path":"knowledge/prefs/jj-gateway-v0-constraints.md","doc_id":"mem_01KGAHB6N20MV56DR4WKR1KMDS","new_hash":"7876a3023b5f1c9dfdcc09d6480ec5e3f0503ca8efb6792763f9fde95f2e3386","patch":{"doc_path":"knowledge/prefs/jj-gateway-v0-constraints.md","title":"JJ Gateway v0.1 constraints & preferences","type":"preference","status":"active","tags_add":["jj","gateway","preferences","security","scope","operations"],"confidence":0.85,"body_append":"## Scope preferences\n\n- v0.1 focuses on a single-node local daemon + two channels (CLI + Telegram) with durable sessions.\n- Defer: web UI, cron, subagents/lanes, tool marketplace, multi-device capabilities.\n\n## Operational preferences\n\n- **Crash-only daemon**: prefer restart over in-place upgrades; continuity via transcripts + session index.\n- Provide graceful shutdown (`SIGINT`/`SIGTERM` + dev-only `gateway.shutdown`).\n\n## Security/safety preferences (v0.1 minimal)\n\n- Gateway should listen on **loopback only** (no remote access).\n- Telegram adapter should be **default deny** via allowlist of chat IDs (or user IDs later).\n- No remote admin endpoints.\n\n## Secrets handling\n\n- Never store model API keys or Telegram bot tokens in transcripts.\n- Load secrets only via environment variables specified in config (e.g., `OPENAI_API_KEY`, `TELEGRAM_BOT_TOKEN`).\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAH9QWXDTVYBKPNG42FDGDE"]}]}}
{"ledger_id":"led_01KGAHFNG382EZDNTJ58GC69N0","ts":"2026-01-31T17:26:49.603307Z","author":"ingest-agent","reason":"Create a source summary for the provided 'claude.md from an earlier assistant' document for future reference.","op":"upsert_knowledge","doc_path":"summaries/sources/claude-md-from-an-earlier-assistant.md","doc_id":"mem_01KGAHFNG2H41C12GRWJE9KAFD","new_hash":"fc9f15c91df8ae875395a2021faef04f550d0966c60674ea339345b3f9d6cf5b","patch":{"doc_path":"summaries/sources/claude-md-from-an-earlier-assistant.md","title":"claude.md from an earlier assistant — CTO Assistant Guide (source summary)","type":"source_summary","tags_add":["source","assistant-guide","loopwork"],"confidence":0.86,"body_append":"## Summary\nThis document defines a lightweight operating manual for a “CTO Assistant” that acts as a thought partner to **Jesse Andrews** at **LoopWork**. The assistant should use a **telegraphic style** (minimal filler/grammar, minimal tokens) and be explicit about blockers (state what’s missing). It is explicitly **not** a coding agent; separate agents do implementation, though the assistant can write code for research/investigation.\n\nThe workflow is structured around persistent context management: at **session start**, read `priorities.md` and relevant files under `context/`. At **session end**, update `priorities.md` if priorities changed, add new information to `context/*.md`, and record significant technical decisions in `decisions/` using an ADR format. The file itself is meant to hold only pointers, with details living in `context/`, `ideas/`, and `decisions/`.\n\nOperational environment notes include repository locations: LoopWork work lives under `~/lw` (clone missing repos from `https://github.com/loopwork/<repo>.git`), and open-source work under `~/oss`. For web research, the assistant should search early, quote exact errors, and prefer sources from **2025–2026**.\n\nCompany/product context captured: LoopWork is pre-product with roughly **$2M runway**; Jesse is CTO (Berkeley) and **Carl** is CEO (SF). The team’s Q1 2025 direction was “Cursor/Claude Code for media,” starting with **images**, after pivoting from **Vibewire** (dev tools; oversaturated). A core technical effort is **Sparks** (`~/lw/sparks`): “agentic-first cloud compute” offering instant sandboxed containers and **btrfs snapshots**. The thesis is that AI apps feel “dead” when frozen; agentic behavior is central to the product.\n\nThe document also sketches an “AI Context Corpus” vision: capturing conversations and consumption as durable context (Granola transcripts, Readwise Reader highlights, a YouTube summarizer tool `~/lw/yt` storing data in `~/.yt/videos/`, chat exports, Claude logs, and a code-change changelog service). Key insight (2025-01-24): “The conversations themselves ARE the context.”\n\n## Noted unknowns / gaps\n- Carl’s background/focus\n- ZOMG code location + learnings\n- Target image workflows\n- Granola API options\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHEDMYRPF9ZX0JNVZ8T2SZ"]}]}}
{"ledger_id":"led_01KGAHFNG4RY23ZTHN68ZPGR95","ts":"2026-01-31T17:26:49.604918Z","author":"ingest-agent","reason":"Add/normalize a person record for Jesse Andrews, capturing biographical and working-style details referenced in the source.","op":"upsert_knowledge","doc_path":"knowledge/people/jesse-andrews.md","doc_id":"mem_01KGAHFNG411EGWX99WTQR7S7Q","new_hash":"1748b130c299439abafee78c7a01c2b28b41927ddc821ab015eead13aab0c06c","patch":{"doc_path":"knowledge/people/jesse-andrews.md","title":"Jesse Andrews","type":"person","tags_add":["loopwork"],"confidence":0.84,"body_append":"## Role\n- CTO at **LoopWork** (based in Berkeley).\n\n## Background (as stated)\n- Creator of **OpenStack** (NASA).\n- Former **SVP Product/Eng at Planet**, leading a ~75 person org.\n- Worked on AI topics including **embeddings** and **autoencoders** (2018–2021).\n- Creator of **userscripts.org**.\n- **Sparks** is described as his first Rust project.\n\n## Working style / beliefs\n- Thinks in metaphors of **cloud as magic** (shifting time/space), **agents as outsourced dev**, and highlights cross-discipline communication gaps.\n- In pre-product phase: values **speed over perfection**; avoid over-engineering.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHEDMYRPF9ZX0JNVZ8T2SZ"]}]}}
{"ledger_id":"led_01KGAHFNG5YD2D37VM9QXYSED5","ts":"2026-01-31T17:26:49.605424Z","author":"ingest-agent","reason":"Create a person stub for Carl (LoopWork CEO) so future notes can attach background/focus as it becomes known.","op":"upsert_knowledge","doc_path":"knowledge/people/carl-loopwork.md","doc_id":"mem_01KGAHFNG5CYPBCMPZXSJHHGMZ","new_hash":"657e832556b7b9ba364f7147e2c45ea2321a9648dad869969d913e614e9671aa","patch":{"doc_path":"knowledge/people/carl-loopwork.md","title":"Carl (LoopWork)","type":"person","tags_add":["loopwork"],"confidence":0.6,"body_append":"## Role\n- CEO at **LoopWork** (based in San Francisco).\n\n## Open questions\n- Background/focus not yet captured in the source notes.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHEDMYRPF9ZX0JNVZ8T2SZ"]}]}}
{"ledger_id":"led_01KGAHFNG6EB39C469ZBY5Z4AV","ts":"2026-01-31T17:26:49.606317Z","author":"ingest-agent","reason":"Create/update a project/org record for LoopWork with the specific product direction, runway, and pivots referenced in the source.","op":"upsert_knowledge","doc_path":"knowledge/projects/loopwork.md","doc_id":"mem_01KGAHFNG64TGPDAAK8S7XM98S","new_hash":"2e9e3f240ee8d46a59ebd567068e0dd673719c8913801abd40294d547da0494d","patch":{"doc_path":"knowledge/projects/loopwork.md","title":"LoopWork","type":"project","tags_add":["company","pre-product"],"confidence":0.82,"body_append":"## Snapshot (2025-01-24)\n- Team: **Jesse Andrews** (CTO, Berkeley) + **Carl** (CEO, SF).\n- Stage: **pre-product**.\n- Runway: ~**$2M** (as stated).\n\n## Direction\n- Q1 2025 concept: “**Cursor/Claude Code for media**” starting with **images first**.\n- Pivoted from **Vibewire** (dev tools), described as an oversaturated space.\n\n## Repos / local layout\n- Work directory: `~/lw`.\n- If a repo is missing: `git clone https://github.com/loopwork/<repo>.git`.\n- Open-source directory: `~/oss`.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHEDMYRPF9ZX0JNVZ8T2SZ"]}]}}
{"ledger_id":"led_01KGAHFNG6098334YKVN4WK72M","ts":"2026-01-31T17:26:49.606729Z","author":"ingest-agent","reason":"Create/update a project record for Sparks, the core infra effort described in the source.","op":"upsert_knowledge","doc_path":"knowledge/projects/sparks.md","doc_id":"mem_01KGAHFNG68QP9XNES1WAH76PT","new_hash":"a06ca9f60464f12efdc85a3b8b9c3e6069c86e22b762855cd0b57b23499f7a13","patch":{"doc_path":"knowledge/projects/sparks.md","title":"Sparks","type":"project","tags_add":["loopwork","infrastructure"],"confidence":0.83,"body_append":"## Overview\n- Location: `~/lw/sparks`.\n- Described as LoopWork’s **core infrastructure**.\n\n## Product/technical thesis\n- “Agentic-first cloud compute”: provide **instant sandboxed containers** and fast state management via **btrfs snapshots**.\n- Thesis statement: AI apps feel “dead” when frozen; the **agentic nature is the product**.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHEDMYRPF9ZX0JNVZ8T2SZ"]}]}}
{"ledger_id":"led_01KGAHFNG7KX3JNCPQANFQPG2Y","ts":"2026-01-31T17:26:49.607332Z","author":"ingest-agent","reason":"Capture assistant interaction preferences and operating rules (telegraphic style, explicit blockers, web-search guidance, start/end session ritual).","op":"upsert_knowledge","doc_path":"knowledge/prefs/cto-assistant-operating-style.md","doc_id":"mem_01KGAHFNG7VP9996HX9YRCDGEM","new_hash":"b961fbf30f25ca3fffa96f43196b7c9f9b48e883fe37bb73768cbd764e7fca06","patch":{"doc_path":"knowledge/prefs/cto-assistant-operating-style.md","title":"CTO Assistant operating style (LoopWork)","type":"preference","tags_add":["style","workflow"],"confidence":0.86,"body_append":"## Writing style\n- **Telegraphic**: drop filler/grammar; minimize tokens.\n\n## Collaboration norms\n- If blocked: explicitly say **what’s missing**.\n- Push back when the user is wrong; ask clarifying questions when unclear.\n- Not a coding agent (implementation delegated), but can write code to investigate/research.\n\n## Web research\n- Search early.\n- Quote **exact errors**.\n- Prefer sources from **2025–2026** when possible.\n\n## Session ritual\n- Start: read `priorities.md` + relevant `context/`.\n- End: update `priorities.md` if shifted; add new info to `context/*.md`; record significant technical decisions in `decisions/` using ADR format.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHEDMYRPF9ZX0JNVZ8T2SZ"]}]}}
{"ledger_id":"led_01KGAHFNG79TSHQC1JXK3V8TY9","ts":"2026-01-31T17:26:49.607803Z","author":"ingest-agent","reason":"Record system/tooling facts about the emerging AI Context Corpus and the specific tools/paths mentioned (Granola, Readwise, yt tool, logs, changelog service).","op":"upsert_knowledge","doc_path":"knowledge/system/ai-context-corpus.md","doc_id":"mem_01KGAHFNG7BHAAG5DTF7X0K6K9","new_hash":"f017ee7ec2b415dc736b8bd10ba9dba862f9bcfe2f6762773ce5faec7a29ecfe","patch":{"doc_path":"knowledge/system/ai-context-corpus.md","title":"AI Context Corpus (LoopWork)","type":"system","tags_add":["context","tooling"],"confidence":0.8,"body_append":"## Goal\nCreate a durable “AI context corpus” by recording conversations and consumption so an AI can understand relationships, thinking evolution, and decision history.\n\n## Key insight\n- (2025-01-24) “**The conversations themselves ARE the context.**”\n\n## Inputs / sources\n- Calls/meetings: **Granola** transcripts (manual sharing now; integrate later).\n- Reading: **Readwise Reader** (read-later + highlights; has an API). Reference noted: `ideas/reader-plan.md`.\n- Videos: **yt tool** at `~/lw/yt` (YouTube summaries via Gemini); stores videos/summaries in `~/.yt/videos/`.\n- Chats: iMessage/Signal exports; potential future “Loop chat”.\n- Claude sessions: logs.\n- Code changes: changelog service (`ideas/changelog-service.md`).\n\n## Inspiration\n- Jeremy Howard’s close reading workflow: load enough context for the AI to understand relationships and evolution over time.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHEDMYRPF9ZX0JNVZ8T2SZ"]}]}}
{"ledger_id":"led_01KGAHKHMZNQ6MFZQ15ZC10MP6","ts":"2026-01-31T17:28:56.735375Z","author":"ingest-agent","reason":"Add source summary for the provided tech-stack document.","op":"upsert_knowledge","doc_path":"summaries/sources/tech-stack.md","doc_id":"mem_01KGAHKHMYCCWS0SHZ9F594J55","new_hash":"d0613ade23664c3e00bcdb894fb15a3ec864b078daece9802cff7b65f1ab0b24","patch":{"doc_path":"summaries/sources/tech-stack.md","title":"tech-stack","type":"source_summary","tags_add":["tech-stack","constraints","tbd"],"confidence":0.85,"body_append":"## Summary\nThis document is a placeholder for capturing **technical stack choices and engineering decisions**. It outlines four stack areas\u0014**Frontend**, **Backend**, **Infrastructure**, and **Third-party services**\u0014but all specific technology selections are currently **TBD**.\n\nIt also establishes an intent to document **technical principles** (a numbered list is present but empty) and explicitly records early **constraints** shaping decisions:\n- The team is **2 people**, with **1 technical** contributor.\n- The company is **pre-funding/bootstrapped**.\n- **Speed to market is critical**.\n\nThe document is marked as last updated **2025-01-23** and should be updated as concrete decisions are made.","sources_add":[{"thread_id":"","event_ids":["src_01KGAHK5ZJC13ZQXP7FV545M72"]}]}}
{"ledger_id":"led_01KGAHKVEG3HZFBK0VRS5X47T2","ts":"2026-01-31T17:29:06.768727Z","author":"ingest-agent","reason":"Capture explicit org-level constraints from the tech-stack source as a reusable system fact for future technical decisions.","op":"upsert_knowledge","doc_path":"knowledge/system/loopwork-org-constraints.md","doc_id":"mem_01KGAHKVEGM4RG43WN59VTW6P6","new_hash":"8f85e1a65000c0462f1141833524bfbf840a24c110cadb8bf823ac6fb9fef739","patch":{"doc_path":"knowledge/system/loopwork-org-constraints.md","title":"LoopWork org constraints (team/budget/speed)","type":"system","status":"active","tags_add":["loopwork","constraints","team","bootstrapped","speed"],"confidence":0.75,"body_append":"## Constraints (as of 2025-01-23)\n- Team size: **2-person team**, with **1 technical** contributor.\n- Funding stage: **pre-funding / bootstrapped**.\n- Priority: **speed to market is critical**.\n\n## Notes\n- This doc records organizational constraints that should shape technical stack decisions while the explicit stack remains TBD.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHK5ZJC13ZQXP7FV545M72"]}]}}
{"ledger_id":"led_01KGAHMXYWDC794JH3JV6Q54SE","ts":"2026-01-31T17:29:42.108547Z","author":"ingest-agent","reason":"Add a source summary capturing the OpenClaw gateway-centric architecture deep-dive for future reference and comparison with JJ Gateway.","op":"upsert_knowledge","doc_path":"summaries/sources/compass-artifact-wf-1cec5d07-e9be-4524-a854-c221ae1f9ce0-text-markdown.md","doc_id":"mem_01KGAHMXYWZ19MFDR049SD9KPE","new_hash":"62fd8b61963520a667d6f7d0eae10646bc9359261334dd03b4c2da7ced7c1444","patch":{"doc_path":"summaries/sources/compass-artifact-wf-1cec5d07-e9be-4524-a854-c221ae1f9ce0-text-markdown.md","title":"OpenClaw technical architecture deep-dive (gateway-centric agent framework)","type":"source_summary","status":"active","tags_add":["openclaw","gateway","agents","architecture","websocket","sessions","serialization","cron","heartbeats","tools","skills","typebox","security"],"confidence":0.86,"body_append":"## Summary\n\nThis document describes **OpenClaw**, a local-first, **gateway-centric AI agent framework** implemented in TypeScript on Node.js (≥22). A single long-running **Gateway daemon** acts as the control plane for **all messaging, session management, scheduling, and tool execution**. The Gateway owns channel connections (WhatsApp via Baileys, Telegram via grammY, Discord via discord.js, Slack via Bolt), enforces *one Gateway per host*, and exposes a loopback WebSocket control plane at `ws://127.0.0.1:18789`.\n\nClients (agent loop, CLI, WebChat UI, mobile nodes, internal scheduler) communicate with the Gateway using a typed JSON WebSocket protocol with frames `req`, `res`, and server-push `event` (streaming). The first frame must be an authenticated `connect` handshake; side-effecting methods (e.g., `agent`, `send`) require **idempotency keys** for safe retries.\n\nA core invariant is **per-session serialization**: inbound messages are routed by binding rules (channel/account/peer/guild; most-specific-wins) to an agent, then queued so only one run executes at a time per session key—analogous to a GenServer-per-session mailbox. The run pipeline is: intake/ack (`{runId, acceptedAt}`), queueing, context assembly (workspace files like `AGENTS.md`, `SOUL.md`, skills), model inference with tool calls, sandboxed tool execution with sanitization, streaming deltas over WebSocket, and persistence to JSONL transcripts with token accounting. Session keys are hierarchical (e.g., `agent:<agentId>:<channel>:dm:<peerId>`).\n\nScheduling is built into the Gateway via **cron jobs** and **heartbeats** (no separate scheduler daemon). Cron jobs can inject events into the main session or run in **isolated sessions** (`cron:<jobId>`) that post results back to main; jobs persist at `~/.openclaw/cron/jobs.json` and concurrency is bounded (`maxConcurrentRuns`). Heartbeats (default 30 min) run proactive checks driven by `HEARTBEAT.md`.\n\nCoordination relies on the Gateway control plane plus optional, allowlisted **agent-to-agent tools** (`sessions_send`, `sessions_spawn`). Sub-agents run in isolated sessions (`agent:<agentId>:subagent:<uuid>`) and cannot recursively spawn further subagents by default.\n\nDurable memory is file-based: daily append-only logs under `~/.openclaw/workspace/memory/YYYY-MM-DD.md`, curated `MEMORY.md`, and JSONL session transcripts. Each agent has an isolated workspace/session store/auth profile to prevent credential leakage.\n\nTools use **TypeBox** schemas for compile-time and runtime validation (with restrictions such as avoiding unions), and higher-level **Skills** are defined in `SKILL.md` with YAML frontmatter and a precedence order (workspace > managed > bundled) gated by environment/binaries/OS requirements. Tool access is controlled by per-agent allow/deny lists, presets, and tool groups.\n\nThe piece highlights patterns: single-daemon gateway control plane, provider/channel abstractions, session-based serialization, layered configuration, DI via a factory (`createDefaultDeps`), and security layering (DM/group policies → tool policy → sandbox → exec approvals). OpenClaw optimizes for single-user local deployment; horizontal scaling would require session affinity and shared state, representing a major architectural change.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHKH7MWX9B27SKEBRWXNJR"]}]}}
{"ledger_id":"led_01KGAHMXYXYRDPES1W4B3QP3XC","ts":"2026-01-31T17:29:42.109625Z","author":"ingest-agent","reason":"Capture OpenClaw as a discrete project entity referenced by the source (useful as an external reference architecture for JJ Gateway).","op":"upsert_knowledge","doc_path":"knowledge/projects/openclaw.md","doc_id":"mem_01KGAHMXYXVT7DX7HY5Z1GTE8E","new_hash":"17228deff0d4e0d275a21c098c21c4eb97d515fc268ca3178e119a77f086060a","patch":{"doc_path":"knowledge/projects/openclaw.md","title":"OpenClaw (gateway-centric AI agent framework)","type":"project","status":"active","tags_add":["openclaw","agent-framework","gateway","nodejs","typescript","websocket","scheduling","tools","skills"],"confidence":0.84,"body_append":"## Overview\n\nOpenClaw is a **gateway-centric AI agent framework** where a single long-running **Gateway daemon** functions as the control plane for:\n\n- channel adapters (WhatsApp/Baileys, Telegram/grammY, Discord/discord.js, Slack/Bolt, etc.)\n- session management and multi-agent routing\n- per-session run coordination (serialized queues)\n- tool execution (sandboxed) and streaming outputs\n- scheduling (cron jobs + heartbeats)\n\nImplemented in TypeScript on Node.js (≥22). The Gateway exposes a loopback WebSocket control plane at `ws://127.0.0.1:18789`.\n\n## Notable design points\n\n- **Single Gateway per host** (e.g., required for WhatsApp Web session ownership).\n- **Typed JSON WebSocket protocol** with `req`/`res`/`event` frames; authenticated `connect` handshake; idempotency keys required for side-effecting calls.\n- **Session-based serialization**: one active run at a time per session key to avoid tool/state races.\n- **Scheduling inside the Gateway**: cron jobs with main vs isolated session modes; periodic heartbeats drive proactive checks via `HEARTBEAT.md`.\n- **Durable memory via filesystem**: daily logs + curated memory + JSONL transcripts; each agent has isolated workspace/session store/auth profile.\n- **Tool/skill system**: tools defined with TypeBox schemas; skills defined via `SKILL.md` with precedence (workspace > managed > bundled) and load-time gating.\n- **Security layering**: channel policies, tool allow/deny lists, sandboxing (e.g., Docker isolation), exec approvals; fail-closed defaults.\n\n## Relationship to JJ Gateway work\n\nUseful as a reference architecture for a local-first \u001cGateway as control plane\u001d design with per-session serialization and a WS framing protocol (req/res/event + idempotency keys).\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHKH7MWX9B27SKEBRWXNJR"]}]}}
{"ledger_id":"led_01KGAHMXYY9FJCSPB40HT2A8B6","ts":"2026-01-31T17:29:42.110237Z","author":"ingest-agent","reason":"Record the OpenClaw Gateway control-plane architecture and protocol details as system facts/patterns that may inform similar implementations.","op":"upsert_knowledge","doc_path":"knowledge/system/openclaw-gateway-architecture.md","doc_id":"mem_01KGAHMXYXQEPBMV1GHC3ZNPC9","new_hash":"18b1f36359bbf61f2c775fb219dae8590f74da3288322522efa5a19074e5c3c9","patch":{"doc_path":"knowledge/system/openclaw-gateway-architecture.md","title":"OpenClaw Gateway architecture & protocol (system facts)","type":"system","status":"active","tags_add":["openclaw","gateway","websocket","protocol","sessions","cron","heartbeats","idempotency"],"confidence":0.83,"body_append":"## Gateway control plane\n\n- Single long-running daemon is the **central control plane** for messaging, scheduling, and tool execution.\n- Enforces **one Gateway per host**.\n- Owns channel connections (examples: WhatsApp/Baileys, Telegram/grammY, Discord/discord.js, Slack/Bolt).\n- Exposes loopback WebSocket control plane: `ws://127.0.0.1:18789`.\n\n## WebSocket framing protocol\n\n- Frame types:\n  - `req`: client request with `method`/`params`\n  - `res`: server response\n  - `event`: server-push, used for streaming deltas\n- First frame must be authenticated `connect` handshake; otherwise the Gateway hard-closes.\n- Side-effecting methods (e.g., `agent`, `send`) require **idempotency keys** to support safe retries.\n\n## Session model & serialization\n\n- Gateway routes inbound messages to agents via **binding rules** (most-specific-wins matching by channel/account/peer/guild).\n- **Runs are queued per session key** (one active run at a time per session), preventing conversation/tool race conditions.\n- Example session key shapes:\n  - DMs: `agent:<agentId>:<channel>:dm:<peerId>`\n  - Groups: `agent:<agentId>:<channel>:group:<id>`\n\n## Run lifecycle (high level)\n\n1. Intake/validation; persist metadata; immediate ack `{runId, acceptedAt}`\n2. Per-session queueing\n3. Context assembly (workspace files like `AGENTS.md`, `SOUL.md`; skills)\n4. LLM inference with streaming + tool calls\n5. Sandboxed tool execution + result sanitization\n6. Stream `assistant`/`tool` deltas as `event`s\n7. Persist final transcript to JSONL; update token counts\n\n## Scheduling inside Gateway\n\n- Two mechanisms: **cron jobs** and **heartbeats** (no separate scheduler daemon).\n- Cron schedule types: `at` (one-shot), `every` (fixed interval), `cron` (cron expression).\n- Cron session modes:\n  - `main`: inject a system event into existing main session\n  - `isolated`: run in new session `cron:<jobId>` and post result back to main\n- Heartbeats: periodic turns in main session (default every 30 minutes) guided by `HEARTBEAT.md`; can return `HEARTBEAT_OK` to suppress messages.\n- Cron persistence: `~/.openclaw/cron/jobs.json`; concurrency bounded by `maxConcurrentRuns`.\n\n## Agent-to-agent coordination (optional)\n\n- Disabled by default; enabled via allowlisting.\n- Tools:\n  - `sessions_send` (bounded ping-pong)\n  - `sessions_spawn` (isolated sub-agent runs)\n- Sub-agent session keys: `agent:<agentId>:subagent:<uuid>`.\n- Sub-agents typically cannot recursively spawn further sub-agents.\n","sources_add":[{"thread_id":"","event_ids":["src_01KGAHKH7MWX9B27SKEBRWXNJR"]}]}}
{"ledger_id":"led_01KGAHNBYW36Y34RV0DRGVGAW4","ts":"2026-01-31T17:29:56.444507Z","author":"ingest-agent","reason":"Add a source summary for the provided 'company' document capturing LoopWork context, status, team, and strategic options.","op":"upsert_knowledge","doc_path":"summaries/sources/company.md","doc_id":"mem_01KGAHNBYWMHZX7M4KZQX0VXW8","new_hash":"231f2b0cc6d308bc3c5204ff3fcc878b0b972db2d7a99b524602d73b1744f330","patch":{"doc_path":"summaries/sources/company.md","title":"LoopWork - Company Context (source summary)","type":"source_summary","status":"active","tags_add":["loopwork","company-context","pre-product"],"confidence":0.9,"body_append":"## Summary\nLoopWork is a pre-product company exploring product–market fit with roughly **$2M cash runway**. The stated focus for **Q1 2025** is building “**Cursor/Claude Code for media**”: AI-assisted creative tooling, **starting with images** in Q1 and expressing interest in **video next**.\n\nThe team consists of **Jesse Andrews (CTO, Berkeley, CA; GitHub @anotherjesse)** and **Carl Peaslee (CEO, San Francisco, CA; GitHub @carlpeaslee)**. Jesse’s background includes initiating and building **OpenStack at NASA**, leading product/engineering at **Planet.com** (growing an org to ~75), and deep AI work (2018–2021) including **embeddings** and **autoencoders**, plus multiple open source projects including **userscripts.org**. An explicit belief/insight attributed to Jesse is that LLMs can **bridge communication gaps across disciplines** (e.g., legal/product/engineering/marketing).\n\nLoopWork’s current status is described as: cash runway secured, but **product not yet defined**, **no MVP**, **no first users**, and **no revenue/market awareness** yet.\n\nPreviously, the company worked on **Vibewire**, a dev-tools concept; some parts remain used internally. LoopWork pivoted away from dev tools due to perceived oversaturation and heavy investment by major model companies.\n\nTwo strategic options are outlined: (1) a **product path** focused on building toward revenue, and (2) an **awareness path** focused on reputation-building with potential **acquihire** outcomes.\n\n*Document last updated: 2025-01-23.*","sources_add":[{"thread_id":"","event_ids":["src_01KGAHMHCW60JR4TWZ1X6Q1C9M"]}]}}
{"ledger_id":"led_01KGAHNBYXK8HDH6V7Z3S8C16F","ts":"2026-01-31T17:29:56.445598Z","author":"ingest-agent","reason":"Update the existing LoopWork project doc with additional current-status checklist and strategic options from this source, and align snapshot date.","op":"upsert_knowledge","doc_path":"knowledge/projects/loopwork.md","doc_id":"mem_01KGAHFNG64TGPDAAK8S7XM98S","prev_hash":"2e9e3f240ee8d46a59ebd567068e0dd673719c8913801abd40294d547da0494d","new_hash":"89f1e52bb547883dc720e81e26785a77c3be98bb6fb85a184f7deefe6e7458c6","patch":{"doc_path":"knowledge/projects/loopwork.md","confidence":0.88,"body_append":"\n\n## Current status (as stated, 2025-01-23)\n- [x] Cash / runway (~$2M)\n- [ ] Product defined (exploring “AI for media”)\n- [ ] MVP built\n- [ ] First users\n- [ ] Revenue / market awareness\n\n## Strategic options (as stated)\n1. **Product path**: build toward revenue.\n2. **Awareness path**: build reputation for potential **acquihire**.\n\n## Team (identifiers)\n- Jesse Andrews (CTO) GitHub: **@anotherjesse**; Berkeley, CA.\n- Carl Peaslee (CEO) GitHub: **@carlpeaslee**; San Francisco, CA.\n\n## Notes\n- Interest expressed in expanding from **images** to **video** after the initial focus.","sources_add":[{"thread_id":"","event_ids":["src_01KGAHMHCW60JR4TWZ1X6Q1C9M"]}]}}
{"ledger_id":"led_01KGAHNBYY89A9HN8J41F4G17G","ts":"2026-01-31T17:29:56.446137Z","author":"ingest-agent","reason":"Update Jesse Andrews person doc with specific GitHub handle, additional career details (Planet Fellow; early LLM conviction trigger), and the explicit insight about LLMs bridging disciplines.","op":"upsert_knowledge","doc_path":"knowledge/people/jesse-andrews.md","doc_id":"mem_01KGAHFNG411EGWX99WTQR7S7Q","prev_hash":"1748b130c299439abafee78c7a01c2b28b41927ddc821ab015eead13aab0c06c","new_hash":"dab3f70b391044c4e8c2e08ac7dbf73c1067cec270d5529c40af8be839107a1c","patch":{"doc_path":"knowledge/people/jesse-andrews.md","confidence":0.9,"body_append":"\n\n## Identifiers\n- GitHub: **@anotherjesse**\n- Location: **Berkeley, CA**\n\n## Additional background (as stated)\n- At **Planet.com**: SVP Product/Eng; later **Fellow**.\n- Early LLM conviction attributed to seeing **Riley Goodside’s GPT-3 Graphviz demo**.\n\n## Stated insight\n- LLMs can help **bridge communication gaps across disciplines** (e.g., legal/product/engineering/marketing use different “languages”).","sources_add":[{"thread_id":"","event_ids":["src_01KGAHMHCW60JR4TWZ1X6Q1C9M"]}]}}
{"ledger_id":"led_01KGAHNBYY1WVKPTPFPQ7DP4KD","ts":"2026-01-31T17:29:56.446792Z","author":"ingest-agent","reason":"Update Carl Peaslee person doc with last name, GitHub handle, and note that he is technical + GTM-capable.","op":"upsert_knowledge","doc_path":"knowledge/people/carl-loopwork.md","doc_id":"mem_01KGAHFNG5CYPBCMPZXSJHHGMZ","prev_hash":"657e832556b7b9ba364f7147e2c45ea2321a9648dad869969d913e614e9671aa","new_hash":"68ba2841172c3fe2caae8ab9e9f83dd9ac8f8de4dc1357666558adc3c7da266c","patch":{"doc_path":"knowledge/people/carl-loopwork.md","confidence":0.85,"body_append":"\n\n## Identifiers\n- Full name: **Carl Peaslee**\n- GitHub: **@carlpeaslee**\n- Location: **San Francisco, CA**\n\n## Background (as stated)\n- Described as **technical + business**: can code and also do **GTM**.","sources_add":[{"thread_id":"","event_ids":["src_01KGAHMHCW60JR4TWZ1X6Q1C9M"]}]}}
